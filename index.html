<!DOCTYPE html>
<html>

<head>
	<title>Flipboard Testing</title>
	<link rel="stylesheet" type="text/css" href="style.css">
	<script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
</head>

<body>

<div id="cards_container">
  <!-- where the divs will be inserted -->
	<img id="ad_container"/>
	<img id="wc_container"/>
</div>
<script>

//---------begin input --------------//
	var WEBCAP = document.getElementById("wc_container");
	var AD_UNIT = document.getElementById("ad_container");
	var CARDS = document.getElementById('cards_container');
	var CARD = [2];
	var width = 0;
	var height = 1;
	var loadedOne = false;
	var loc = "images/";
	var offX = 0;
	var offY = 0;
	//how many images?

	//image source name
	WEBCAP.src = loc + "WC_1.png";
	AD_UNIT.src = loc + "panda.png";

	WEBCAP.style.display = "none";
	AD_UNIT.style.display = "none";

    //how many images do you want to display across?
	var NUM_IMG_ACROSS = 5;
	var NUM_IMG_DOWN = 4;
	var numImgs = NUM_IMG_ACROSS*NUM_IMG_DOWN;
	//define the width of each image in pixels

	//define youre speed in seconds you want the animation to take
	var SPEED = 3;

	//define the time to iterate the flip in seconds. use 0 if not
	var ITERATION = 1;

	function ensureMatchedSize(){
		if (WEBCAP.style.width != AD_UNIT.style.width){
			AD_UNIT.style.width = WEBCAP.style.width;
		}
	}

	//make sure both the bg_img and ad_img have loaded before checking width and height
	$("#wc_container, #ad_container").load(function() {

		if (loadedOne){
			//show the bg
			//WEBCAP.style.display = "block";

			ensureMatchedSize();

			CARDS.style.width = WEBCAP.width + "px";
			CARDS.style.height = WEBCAP.height + "px";

			CARD[width] = (WEBCAP.width/NUM_IMG_ACROSS);
			CARD[height] = (WEBCAP.height/NUM_IMG_DOWN);

			console.log("CARD width: " + CARD[width]);
			console.log("CARD height: " + CARD[height]);

			createFlipDivs();
			FORWARD = true;
			flipCards();
		}
		else {
			loadedOne = true;
		}
	});
//---------end input --------------//

	function createFlipDivs(){
		//document.getElementById("random_flip").innerHtml = ""

		for(i = 1; i < NUM_IMG_DOWN + 1; i++) {
			for(j = 1; j < NUM_IMG_ACROSS + 1; j++) {
				console.log("here");
				CARDS.innerHTML = CARDS.innerHTML + '\
				<div id="card" data-number="' + i + j + '" style="">\
						<div class="front" style="' +
							'width:' + CARD[width] + 'px;' +
							'height:' + CARD[height] + 'px;' +
							'background-position: -' + (j - 1) * CARD[width] + 'px -' + CARD[height] * (i - 1) + 'px;' +
							'margin-left: -' + offX + 'px;' +
							'margin-top: -' + offY + 'px;' +
							'display: inline-block;' +
							'background-image: url(' + AD_UNIT.src + ');"></div>\
						<div class="back" style="' +
							'width:' + CARD[width] + 'px;' +
							'height:' + CARD[height] + 'px;' +
							'background-position: -' + (j - 1) * CARD[width] + 'px -' + CARD[height] * (i - 1) + 'px;' +
							'margin-left: -' + CARD[width] + 'px;' +
							'display: inline-block;' +
							'background-image: url(' + WEBCAP.src + ');">\
						</div>\
				</div>';
				//if you've hit the end of the line
				if (i % NUM_IMG_ACROSS == 0) {
					CARDS.innerHTML = CARDS.innerHTML + '<br>';
				}
			}
  		}

  		
	}

	function flipCards(){

			//set speed of each box so total will be user input
			var speed = SPEED*1000/numImgs;

			//start at the top left card
			var cardIndex = 0;

		  	//store cards as list
		  	var cardList = document.querySelectorAll("#card");

		  	//what direction are we flipping
	   		if (FORWARD){
	   			console.log("flipping forward");
		  		//every "speed" seconds call nextCard
		    	var myTimer = setInterval(nextCard, speed);
	 		}
	 		else{
	 			console.log("flipping backwards");
	 			//every "speed" seconds call nextCard
		    	var myTimer = setInterval(prevCard, speed);
	 		}

	 		function nextCard() {
	   			var c = cardList[cardIndex].classList;
	   			c.add("flipped");
	   			cardIndex = cardIndex + 1;
	   			if (cardIndex == numImgs){
	   				clearInterval(myTimer);
	   			}
	  		}

	  		function prevCard() {
				var c = cardList[cardIndex].classList;
				c.remove("flipped");
				cardIndex = cardIndex + 1;
				if (cardIndex == numImgs) {
					clearInterval(myTimer);
				}
			}
		}

</script>

</body>
</html>