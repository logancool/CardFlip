<!DOCTYPE html>
<html>

<head>
	<title>Flipboard Testing</title>
	<link rel="stylesheet" type="text/css" href="style.css">
	<script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
</head>

<body>

<div id="cards_container">
  <!-- where the divs will be inserted -->
	<img id="ad_container"/>
	<img id="wc_container"/>
</div>
<script>


	var WEBCAP = document.getElementById("wc_container");
	var AD_UNIT = document.getElementById("ad_container");
	var CARDS = document.getElementById('cards_container');
	var CARD = [2];
	var width = 0;
	var height = 1;
	var loadedOne = false;
	var loc = "images/";
	var offX = 0;
	var offY = 0;
	var cardIndex = 0;
	var cardTimer;

//---------begin input --------------//

	//image source name
	WEBCAP.src = loc + "WC_1.png";
	AD_UNIT.src = loc + "panda.png";

    //how many images do you want to display across? (1 - 20)
	var NUM_IMG_ACROSS = 10;
	var NUM_IMG_DOWN = 1;

	//define youre speed in seconds you want the animation to take
	var SPEED = 3;

	//define the time to iterate the flip in seconds. use 0 if not
	var ITERATION = 1;

//---------end input --------------//


	if (NUM_IMG_ACROSS > 20) NUM_IMG_ACROSS = 20; //failsafe for high computation
	if (NUM_IMG_DOWN > 20) NUM_IMG_DOWN = 20; // also a failsafe
	var numImgs = NUM_IMG_ACROSS*NUM_IMG_DOWN;

	WEBCAP.style.display = "none";
	AD_UNIT.style.display = "none";

	//set speed of each box so total will be user input
	SPEED = SPEED*1000/numImgs;

	function ensureMatchedSize(){
		console.log("WC: " + WEBCAP.width + " AD: " + AD_UNIT.width);
		if (WEBCAP.width != AD_UNIT.width){
			console.log("These sizes don't match");
			return false;
		}
		else {
			return true;
		}
	}
	function displayDefault(){
		AD_UNIT.style.display = "block";
	}

	//make sure both the bg_img and ad_img have loaded before checking width and height
	$("#wc_container, #ad_container").load(function() {

		if (loadedOne){
			//show the bg
			//WEBCAP.style.display = "block";

			CARDS.style.width = WEBCAP.width + "px";
			CARDS.style.height = WEBCAP.height + "px";

			CARD[width] = (WEBCAP.width/NUM_IMG_ACROSS);
			CARD[height] = (WEBCAP.height/NUM_IMG_DOWN);

			console.log("CARD width: " + CARD[width]);
			console.log("CARD height: " + CARD[height]);

			//if the sizes match, go ahead with the animation
			if (ensureMatchedSize()) {

				createFlipDivs();

				//store cards as list
				var cardList = document.querySelectorAll("#card");

				//flip cards at interval
				cardTimer = setInterval(function(){flipCard(cardList)}, SPEED);
			}
			else {
				displayDefault();
			}
		}
		else {
			loadedOne = true;
		}
	});

	function closeClicked(){

	}

	function createFlipDivs(){
		//document.getElementById("random_flip").innerHtml = ""

		for(i = 1; i < NUM_IMG_DOWN + 1; i++) {
			for(j = 1; j < NUM_IMG_ACROSS + 1; j++) {
				console.log("here");
				CARDS.innerHTML = CARDS.innerHTML + '\
				<div id="card" data-number="' + i + j + '" style="">\
						<div class="front" style="' +
							'width:' + CARD[width] + 'px;' +
							'height:' + CARD[height] + 'px;' +
							'background-position: -' + (j - 1) * CARD[width] + 'px -' + CARD[height] * (i - 1) + 'px;' +
							'margin-left: -' + offX + 'px;' +
							'margin-top: -' + offY + 'px;' +
							'display: inline-block;' +
							'background-image: url(' + WEBCAP.src + ');"></div>\
						<div class="back" style="' +
							'width:' + CARD[width] + 'px;' +
							'height:' + CARD[height] + 'px;' +
							'background-position: -' + (j - 1) * CARD[width] + 'px -' + CARD[height] * (i - 1) + 'px;' +
							'margin-left: -' + CARD[width] + 'px;' +
							'display: inline-block;' +
							'background-image: url(' + AD_UNIT.src + ');">\
						</div>\
				</div>';

			}
  		}

  		
	}

	function flipCard(cardList){
			console.log("called!!!");
			var c = cardList[cardIndex].classList;
			c.add("flipped");
			cardIndex = cardIndex + 1;
			if (cardIndex == numImgs){
				clearInterval(cardTimer);
			}

	}

</script>

</body>
</html>